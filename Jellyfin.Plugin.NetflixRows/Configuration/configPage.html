<!DOCTYPE html>
<html>
<head>
    <title>Netflix Rows Configuration</title>
</head>
<body>
    <div data-role="page" class="page type-interior pluginConfigurationPage" id="netflixRowsConfigPage">
        <div data-role="content">
            <div class="content-primary">
                <form id="netflixRowsConfigForm">
                    <div class="sectionTitleContainer flex align-items-center">
                        <h2 class="sectionTitle">Netflix Rows Plugin</h2>
                    </div>
                    <p class="description">Transform your Jellyfin home screen into a Netflix-like experience with dynamic rows and a custom watchlist.</p>
                    
                    <div class="verticalSection">
                        <div class="sectionTitleContainer flex align-items-center">
                            <h3 class="sectionTitle">General Settings</h3>
                        </div>
                        
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="maxRows">Maximum Rows</label>
                            <input type="number" id="maxRows" name="maxRows" value="8" min="1" max="20" is="emby-input" class="emby-input">
                            <div class="fieldDescription">Maximum number of rows to display on the home page</div>
                        </div>
                        
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="maxItemsPerRow">Items per Row</label>
                            <input type="number" id="maxItemsPerRow" name="maxItemsPerRow" value="25" min="5" max="50" is="emby-input" class="emby-input">
                            <div class="fieldDescription">Number of items to show in each row</div>
                        </div>
                    </div>
                    
                    <div class="verticalSection">
                        <div class="sectionTitleContainer flex align-items-center">
                            <h3 class="sectionTitle">Row Types</h3>
                        </div>
                        
                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" id="enableMyList" name="enableMyList" checked is="emby-checkbox">
                                <span>My List</span>
                            </label>
                            <div class="fieldDescription checkboxFieldDescription">Show user favorites in a dedicated row (❤️ button)</div>
                        </div>
                        
                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" id="enableRecentlyAdded" name="enableRecentlyAdded" checked is="emby-checkbox">
                                <span>Recently Added</span>
                            </label>
                            <div class="fieldDescription checkboxFieldDescription">Show recently added content</div>
                        </div>
                        
                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" id="enableRandomPicks" name="enableRandomPicks" checked is="emby-checkbox">
                                <span>Random Picks</span>
                            </label>
                            <div class="fieldDescription checkboxFieldDescription">Show random content suggestions</div>
                        </div>
                    </div>
                    
                    <div class="verticalSection">
                        <div class="sectionTitleContainer flex align-items-center">
                            <h3 class="sectionTitle">Genre Rows</h3>
                        </div>
                        
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" id="genreAction" name="enabledGenres" value="Action" checked is="emby-checkbox">
                                <span>Action</span>
                            </label>
                        </div>
                        
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" id="genreComedy" name="enabledGenres" value="Comedy" checked is="emby-checkbox">
                                <span>Comedy</span>
                            </label>
                        </div>
                        
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" id="genreAnime" name="enabledGenres" value="Anime" checked is="emby-checkbox">
                                <span>Anime</span>
                            </label>
                        </div>
                        
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" id="genreDrama" name="enabledGenres" value="Drama" is="emby-checkbox">
                                <span>Drama</span>
                            </label>
                        </div>
                        
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" id="genreHorror" name="enabledGenres" value="Horror" is="emby-checkbox">
                                <span>Horror</span>
                            </label>
                        </div>
                        
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" id="genreSciFi" name="enabledGenres" value="Sci-Fi" is="emby-checkbox">
                                <span>Science Fiction</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="verticalSection">
                        <button type="button" id="saveBtn" is="emby-button" class="raised button-submit emby-button">
                            <span>Save</span>
                        </button>
                    </div>
                </form>
                
                <div id="status" style="margin-top: 1em; display: none;"></div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        (function() {
            'use strict';

            var NetflixRowsConfigPage = {
                currentConfig: {},

                loadConfig: function() {
                    var self = this;
                    ApiClient.getJSON(ApiClient.getUrl('NetflixRows/Config')).then(function(config) {
                        self.currentConfig = config;
                        self.populateForm(config);
                        self.showStatus('Configuration loaded', 'success');
                    }).catch(function(error) {
                        console.error('Error loading configuration:', error);
                        self.showStatus('Error loading configuration', 'error');
                    });
                },

                populateForm: function(config) {
                    // Basic settings
                    var maxRows = document.getElementById('maxRows');
                    if (maxRows && config.maxRows !== undefined) {
                        maxRows.value = config.maxRows;
                    }
                    
                    var maxItemsPerRow = document.getElementById('maxItemsPerRow');
                    if (maxItemsPerRow && config.maxItemsPerRow !== undefined) {
                        maxItemsPerRow.value = config.maxItemsPerRow;
                    }
                    
                    // Row types
                    this.setCheckbox('enableMyList', config.enableMyList !== false);
                    this.setCheckbox('enableRecentlyAdded', config.enableRecentlyAdded !== false);
                    this.setCheckbox('enableRandomPicks', config.enableRandomPicks !== false);
                    
                    // Genres
                    if (config.enabledGenres && Array.isArray(config.enabledGenres)) {
                        var genreCheckboxes = document.querySelectorAll('input[name="enabledGenres"]');
                        genreCheckboxes.forEach(function(checkbox) {
                            checkbox.checked = config.enabledGenres.indexOf(checkbox.value) !== -1;
                        });
                    }
                },

                setCheckbox: function(id, checked) {
                    var element = document.getElementById(id);
                    if (element) {
                        element.checked = checked;
                    }
                },

                saveConfig: function() {
                    var self = this;
                    var config = {
                        maxRows: parseInt(document.getElementById('maxRows').value) || 8,
                        maxItemsPerRow: parseInt(document.getElementById('maxItemsPerRow').value) || 25,
                        minItemsPerRow: 10,
                        enableMyList: document.getElementById('enableMyList').checked,
                        enableRecentlyAdded: document.getElementById('enableRecentlyAdded').checked,
                        enableRandomPicks: document.getElementById('enableRandomPicks').checked,
                        enableLongNotWatched: this.currentConfig.enableLongNotWatched || false,
                        enabledGenres: [],
                        blacklistedGenres: this.currentConfig.blacklistedGenres || [],
                        recentlyAddedDays: this.currentConfig.recentlyAddedDays || 30,
                        longNotWatchedMonths: this.currentConfig.longNotWatchedMonths || 6,
                        minGenreItems: this.currentConfig.minGenreItems || 5,
                        myListLimit: this.currentConfig.myListLimit || 50,
                        randomRowOrder: this.currentConfig.randomRowOrder || false,
                        lazyLoadRows: this.currentConfig.lazyLoadRows !== false,
                        replaceHeartWithPlus: this.currentConfig.replaceHeartWithPlus !== false,
                        myListCount: this.currentConfig.myListCount || 20,
                        recentlyAddedCount: this.currentConfig.recentlyAddedCount || 20,
                        randomPicksCount: this.currentConfig.randomPicksCount || 20
                    };

                    // Collect enabled genres
                    var genreCheckboxes = document.querySelectorAll('input[name="enabledGenres"]:checked');
                    genreCheckboxes.forEach(function(checkbox) {
                        config.enabledGenres.push(checkbox.value);
                    });

                    self.showStatus('Saving...', 'info');

                    ApiClient.ajax({
                        type: 'POST',
                        url: ApiClient.getUrl('NetflixRows/Config'),
                        data: JSON.stringify(config),
                        contentType: 'application/json'
                    }).then(function() {
                        self.currentConfig = config;
                        self.showStatus('Configuration saved successfully!', 'success');
                    }).catch(function(error) {
                        console.error('Error saving configuration:', error);
                        self.showStatus('Error saving configuration', 'error');
                    });
                },

                showStatus: function(message, type) {
                    var statusDiv = document.getElementById('status');
                    if (statusDiv) {
                        statusDiv.textContent = message;
                        statusDiv.style.display = 'block';
                        statusDiv.className = 'fieldDescription status-' + type;
                        
                        if (type === 'success') {
                            setTimeout(function() {
                                statusDiv.style.display = 'none';
                            }, 3000);
                        }
                    }
                },

                init: function() {
                    var self = this;
                    var saveBtn = document.getElementById('saveBtn');
                    if (saveBtn) {
                        saveBtn.addEventListener('click', function() {
                            self.saveConfig();
                        });
                    }
                    
                    // Load configuration on page load
                    this.loadConfig();
                }
            };

            // Initialize when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    NetflixRowsConfigPage.init();
                });
            } else {
                NetflixRowsConfigPage.init();
            }
        })();
    </script>
    
    <style>
        .status-success {
            color: #00a652;
        }
        
        .status-error {
            color: #cc3333;
        }
        
        .status-info {
            color: #00a4dc;
        }
        
        .description {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 2em;
        }
        
        .verticalSection {
            margin-bottom: 2em;
        }
        
        .sectionTitle {
            color: #00a4dc;
        }
        
        .checkboxContainer-withDescription {
            margin-bottom: 1.5em;
        }
        
        .checkboxFieldDescription {
            margin-left: 1.8em;
            margin-top: 0.3em;
        }
    </style>
</body>
</html>