<!DOCTYPE html>
<html lang="de">
<head>
    <title>Netflix Rows Einstellungen</title>
    <style>
        .configPage {
            padding: 20px;
            color: white;
        }
        .configSection {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #333;
            border-radius: 5px;
            background: rgba(0,0,0,0.3);
        }
        .configSection h3 {
            color: #00a4dc;
            margin-top: 0;
        }
        .inputContainer {
            margin: 15px 0;
        }
        .inputContainer label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .inputContainer input, .inputContainer select {
            width: 200px;
            padding: 8px;
            border: 1px solid #555;
            border-radius: 3px;
            background: #333;
            color: white;
        }
        .checkboxContainer {
            margin: 10px 0;
        }
        .checkboxContainer input {
            width: auto;
            margin-right: 8px;
        }
        .saveButton {
            background: #00a4dc;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 20px;
        }
        .saveButton:hover {
            background: #0080b0;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            display: none;
        }
        .status.success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid #4CAF50;
            color: #4CAF50;
        }
        .status.error {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #f44336;
            color: #f44336;
        }
    </style>
</head>
<body>
    <div class="configPage">
        <h1>Netflix Rows Plugin Einstellungen</h1>
        
        <div id="statusMessage" class="status"></div>
        
        <form id="configForm">
            <div class="configSection">
                <h3>Basis-Einstellungen</h3>
                
                <div class="inputContainer">
                    <label for="maxRows">Maximale Anzahl Rows:</label>
                    <input type="number" id="maxRows" min="1" max="20" value="8">
                </div>
                
                <div class="inputContainer">
                    <label for="maxItemsPerRow">Items pro Row:</label>
                    <input type="number" id="maxItemsPerRow" min="5" max="50" value="25">
                </div>
                
                <div class="inputContainer">
                    <label for="recentlyAddedDays">Kürzlich hinzugefügt (Tage):</label>
                    <input type="number" id="recentlyAddedDays" min="1" max="365" value="30">
                </div>
            </div>
            
            <div class="configSection">
                <h3>Aktive Row-Typen</h3>
                
                <div class="checkboxContainer">
                    <input type="checkbox" id="enableMyList" checked>
                    <label for="enableMyList">Meine Liste</label>
                </div>
                
                <div class="checkboxContainer">
                    <input type="checkbox" id="enableRecentlyAdded" checked>
                    <label for="enableRecentlyAdded">Kürzlich hinzugefügt</label>
                </div>
                
                <div class="checkboxContainer">
                    <input type="checkbox" id="enableRandomPicks" checked>
                    <label for="enableRandomPicks">Zufällige Auswahl</label>
                </div>
                
                <div class="checkboxContainer">
                    <input type="checkbox" id="enableGenres" checked>
                    <label for="enableGenres">Genre-Rows</label>
                </div>
            </div>
            
            <button type="submit" class="saveButton">Einstellungen speichern</button>
        </form>
    </div>

    <script>
        const pluginId = "6c0b8d8a-6b1c-4c5a-9b0a-1b2c3d4e5f6a";
        
        function showStatus(message, isError = false) {
            const status = document.getElementById('statusMessage');
            status.textContent = message;
            status.className = 'status ' + (isError ? 'error' : 'success');
            status.style.display = 'block';
            setTimeout(() => status.style.display = 'none', 3000);
        }

        function loadConfig() {
            console.log('Loading Netflix Rows configuration...');
            
            if (typeof ApiClient === 'undefined') {
                showStatus('ApiClient not available', true);
                return;
            }

            ApiClient.getPluginConfiguration(pluginId).then(config => {
                console.log('Loaded config:', config);
                
                document.getElementById('maxRows').value = config.MaxRows || 8;
                document.getElementById('maxItemsPerRow').value = config.MaxItemsPerRow || 25;
                document.getElementById('recentlyAddedDays').value = config.RecentlyAddedDays || 30;
                
                const enabledRowTypes = config.EnabledRowTypes || {};
                document.getElementById('enableMyList').checked = enabledRowTypes.MyList !== false;
                document.getElementById('enableRecentlyAdded').checked = enabledRowTypes.RecentlyAdded !== false;
                document.getElementById('enableRandomPicks').checked = enabledRowTypes.RandomPicks !== false;
                document.getElementById('enableGenres').checked = enabledRowTypes.Genres !== false;
                
                showStatus('Einstellungen geladen');
            }).catch(error => {
                console.error('Config load error:', error);
                showStatus('Fehler beim Laden: ' + error.message, true);
            });
        }

        function saveConfig(e) {
            e.preventDefault();
            
            console.log('Saving Netflix Rows configuration...');
            
            if (typeof ApiClient === 'undefined') {
                showStatus('ApiClient not available', true);
                return;
            }

            const config = {
                MaxRows: parseInt(document.getElementById('maxRows').value),
                MinItemsPerRow: 10,
                MaxItemsPerRow: parseInt(document.getElementById('maxItemsPerRow').value),
                RecentlyAddedDays: parseInt(document.getElementById('recentlyAddedDays').value),
                LongNotWatchedMonths: 6,
                MyListLimit: 50,
                MinGenreItems: 5,
                EnabledGenres: ["Action", "Comedy", "Drama", "Animation", "Anime"],
                BlacklistedGenres: [],
                EnabledRowTypes: {
                    MyList: document.getElementById('enableMyList').checked,
                    RecentlyAdded: document.getElementById('enableRecentlyAdded').checked,
                    RandomPicks: document.getElementById('enableRandomPicks').checked,
                    Genres: document.getElementById('enableGenres').checked,
                    LongNotWatched: false
                }
            };
            
            console.log('Saving config:', config);

            ApiClient.updatePluginConfiguration(pluginId, config).then(() => {
                console.log('Configuration saved successfully');
                showStatus('Einstellungen gespeichert!');
            }).catch(error => {
                console.error('Config save error:', error);
                showStatus('Speicherfehler: ' + error.message, true);
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Netflix Rows config page loaded');
            document.getElementById('configForm').addEventListener('submit', saveConfig);
            
            // Load config after a short delay to ensure ApiClient is ready
            setTimeout(loadConfig, 500);
        });
        
        // Also try immediate load in case DOM is already ready
        if (document.readyState !== 'loading') {
            document.getElementById('configForm').addEventListener('submit', saveConfig);
            setTimeout(loadConfig, 500);
        }
    </script>
</body>
</html> 