<!DOCTYPE html>
<html>
<head>
    <title>Netflix Rows Configuration</title>
</head>
<body>
    <div data-role="page" class="page type-interior pluginConfigurationPage" id="netflixRowsConfigPage">
        <div data-role="content">
            <div class="content-primary">
                <form id="netflixRowsConfigForm">
                    <div class="sectionTitleContainer flex align-items-center">
                        <h2 class="sectionTitle">Netflix Rows Plugin</h2>
                    </div>
                    <p class="description">Transform your Jellyfin home screen into a Netflix-like experience with dynamic rows and a custom watchlist.</p>
                    
                    <div class="verticalSection">
                        <div class="sectionTitleContainer flex align-items-center">
                            <h3 class="sectionTitle">General Settings</h3>
                        </div>
                        
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="maxRows">Maximum Rows</label>
                            <input type="number" id="maxRows" name="maxRows" value="8" min="1" max="20" is="emby-input" class="emby-input">
                            <div class="fieldDescription">Maximum number of rows to display on the home page</div>
                        </div>
                        
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="maxItemsPerRow">Items per Row</label>
                            <input type="number" id="maxItemsPerRow" name="maxItemsPerRow" value="25" min="5" max="50" is="emby-input" class="emby-input">
                            <div class="fieldDescription">Number of items to show in each row</div>
                        </div>
                        
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="minItemsPerRow">Minimum Items per Row</label>
                            <input type="number" id="minItemsPerRow" name="minItemsPerRow" value="10" min="1" max="25" is="emby-input" class="emby-input">
                            <div class="fieldDescription">Minimum items required to show a row</div>
                        </div>
                        
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="recentlyAddedDays">Recently Added Period (Days)</label>
                            <input type="number" id="recentlyAddedDays" name="recentlyAddedDays" value="30" min="1" max="365" is="emby-input" class="emby-input">
                            <div class="fieldDescription">How many days back to consider for "Recently Added"</div>
                        </div>
                        
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="longNotWatchedMonths">Long Not Watched Period (Months)</label>
                            <input type="number" id="longNotWatchedMonths" name="longNotWatchedMonths" value="6" min="1" max="24" is="emby-input" class="emby-input">
                            <div class="fieldDescription">Months to consider content as "long not watched"</div>
                        </div>
                        
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="minGenreItems">Minimum Genre Items</label>
                            <input type="number" id="minGenreItems" name="minGenreItems" value="5" min="1" max="20" is="emby-input" class="emby-input">
                            <div class="fieldDescription">Minimum items required to create a genre row</div>
                        </div>
                        
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="myListLimit">My List Limit</label>
                            <input type="number" id="myListLimit" name="myListLimit" value="50" min="10" max="200" is="emby-input" class="emby-input">
                            <div class="fieldDescription">Maximum items to show in My List row</div>
                        </div>
                    </div>
                    
                    <div class="verticalSection">
                        <div class="sectionTitleContainer flex align-items-center">
                            <h3 class="sectionTitle">Row Types</h3>
                        </div>
                        
                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" id="enableMyList" name="enableMyList" checked is="emby-checkbox">
                                <span>My List</span>
                            </label>
                            <div class="fieldDescription checkboxFieldDescription">Show user favorites in a dedicated row (❤️ button)</div>
                        </div>
                        
                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" id="enableRecentlyAdded" name="enableRecentlyAdded" checked is="emby-checkbox">
                                <span>Recently Added</span>
                            </label>
                            <div class="fieldDescription checkboxFieldDescription">Show recently added content</div>
                        </div>
                        
                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" id="enableRandomPicks" name="enableRandomPicks" checked is="emby-checkbox">
                                <span>Random Picks</span>
                            </label>
                            <div class="fieldDescription checkboxFieldDescription">Show random content suggestions</div>
                        </div>
                        
                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" id="enableLongNotWatched" name="enableLongNotWatched" is="emby-checkbox">
                                <span>Long Not Watched</span>
                            </label>
                            <div class="fieldDescription checkboxFieldDescription">Show content that hasn't been watched for a long time</div>
                        </div>
                    </div>
                    
                    <div class="verticalSection">
                        <div class="sectionTitleContainer flex align-items-center">
                            <h3 class="sectionTitle">Advanced Options</h3>
                            <button type="button" class="collapsible-toggle" data-target="advancedSection" style="margin-left: auto;">
                                <i class="md-icon">keyboard_arrow_down</i>
                            </button>
                        </div>
                        
                        <div id="advancedSection" class="collapsible-content" style="display: none;">
                            <div class="checkboxContainer checkboxContainer-withDescription">
                                <label class="emby-checkbox-label">
                                    <input type="checkbox" id="randomRowOrder" name="randomRowOrder" is="emby-checkbox">
                                    <span>Random Row Order</span>
                                </label>
                                <div class="fieldDescription checkboxFieldDescription">Randomize the order of rows on each page load</div>
                            </div>
                            
                            <div class="checkboxContainer checkboxContainer-withDescription">
                                <label class="emby-checkbox-label">
                                    <input type="checkbox" id="lazyLoadRows" name="lazyLoadRows" checked is="emby-checkbox">
                                    <span>Lazy Load Rows</span>
                                </label>
                                <div class="fieldDescription checkboxFieldDescription">Load row content as needed (recommended for performance)</div>
                            </div>
                            
                            <div class="checkboxContainer checkboxContainer-withDescription">
                                <label class="emby-checkbox-label">
                                    <input type="checkbox" id="replaceHeartWithPlus" name="replaceHeartWithPlus" checked is="emby-checkbox">
                                    <span>Replace Heart with Plus</span>
                                </label>
                                <div class="fieldDescription checkboxFieldDescription">Replace ❤️ button with ➕ button for My List</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="verticalSection">
                        <div class="sectionTitleContainer flex align-items-center">
                            <h3 class="sectionTitle">Genre Rows</h3>
                            <button type="button" class="collapsible-toggle" data-target="genreSection" style="margin-left: auto;">
                                <i class="md-icon">keyboard_arrow_down</i>
                            </button>
                        </div>
                        
                        <div id="genreSection" class="collapsible-content" style="display: none;">
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input type="checkbox" id="genreAction" name="enabledGenres" value="Action" checked is="emby-checkbox">
                                    <span>Action</span>
                                </label>
                            </div>
                            
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input type="checkbox" id="genreComedy" name="enabledGenres" value="Comedy" checked is="emby-checkbox">
                                    <span>Comedy</span>
                                </label>
                            </div>
                            
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input type="checkbox" id="genreAnime" name="enabledGenres" value="Anime" checked is="emby-checkbox">
                                    <span>Anime</span>
                                </label>
                            </div>
                            
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input type="checkbox" id="genreDrama" name="enabledGenres" value="Drama" is="emby-checkbox">
                                    <span>Drama</span>
                                </label>
                            </div>
                            
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input type="checkbox" id="genreHorror" name="enabledGenres" value="Horror" is="emby-checkbox">
                                    <span>Horror</span>
                                </label>
                            </div>
                            
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input type="checkbox" id="genreSciFi" name="enabledGenres" value="Sci-Fi" is="emby-checkbox">
                                    <span>Science Fiction</span>
                                </label>
                            </div>
                            
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input type="checkbox" id="genreRomance" name="enabledGenres" value="Romance" is="emby-checkbox">
                                    <span>Romance</span>
                                </label>
                            </div>
                            
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input type="checkbox" id="genreThriller" name="enabledGenres" value="Thriller" is="emby-checkbox">
                                    <span>Thriller</span>
                                </label>
                            </div>
                            
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input type="checkbox" id="genreFantasy" name="enabledGenres" value="Fantasy" is="emby-checkbox">
                                    <span>Fantasy</span>
                                </label>
                            </div>
                            
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input type="checkbox" id="genreCrime" name="enabledGenres" value="Crime" is="emby-checkbox">
                                    <span>Crime</span>
                                </label>
                            </div>
                            
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input type="checkbox" id="genreDocumentary" name="enabledGenres" value="Documentary" is="emby-checkbox">
                                    <span>Documentary</span>
                                </label>
                            </div>
                            
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input type="checkbox" id="genreAdventure" name="enabledGenres" value="Adventure" is="emby-checkbox">
                                    <span>Adventure</span>
                                </label>
                            </div>
                            
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input type="checkbox" id="genreAnimation" name="enabledGenres" value="Animation" is="emby-checkbox">
                                    <span>Animation</span>
                                </label>
                            </div>
                            
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input type="checkbox" id="genreFamily" name="enabledGenres" value="Family" is="emby-checkbox">
                                    <span>Family</span>
                                </label>
                            </div>
                            
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input type="checkbox" id="genreHistory" name="enabledGenres" value="History" is="emby-checkbox">
                                    <span>History</span>
                                </label>
                            </div>
                            
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input type="checkbox" id="genreMusic" name="enabledGenres" value="Music" is="emby-checkbox">
                                    <span>Music</span>
                                </label>
                            </div>
                            
                            <div class="checkboxContainer">
                                <label class="emby-checkbox-label">
                                    <input type="checkbox" id="genreWestern" name="enabledGenres" value="Western" is="emby-checkbox">
                                    <span>Western</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="verticalSection">
                        <button type="button" id="saveBtn" is="emby-button" class="raised button-submit emby-button">
                            <span>Save</span>
                        </button>
                    </div>
                </form>
                
                <div id="status" style="margin-top: 1em; display: none;"></div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        (function() {
            'use strict';

            var NetflixRowsConfigPage = {
                currentConfig: {},

                loadConfig: function() {
                    var self = this;
                    ApiClient.getJSON(ApiClient.getUrl('NetflixRows/Config')).then(function(config) {
                        self.currentConfig = config;
                        self.populateForm(config);
                        self.showStatus('Configuration loaded', 'success');
                    }).catch(function(error) {
                        console.error('Error loading configuration:', error);
                        self.showStatus('Error loading configuration', 'error');
                    });
                },

                populateForm: function(config) {
                    // Basic settings
                    var maxRows = document.getElementById('maxRows');
                    if (maxRows && config.maxRows !== undefined) {
                        maxRows.value = config.maxRows;
                    }
                    
                    var maxItemsPerRow = document.getElementById('maxItemsPerRow');
                    if (maxItemsPerRow && config.maxItemsPerRow !== undefined) {
                        maxItemsPerRow.value = config.maxItemsPerRow;
                    }
                    
                    var minItemsPerRow = document.getElementById('minItemsPerRow');
                    if (minItemsPerRow && config.minItemsPerRow !== undefined) {
                        minItemsPerRow.value = config.minItemsPerRow;
                    }
                    
                    var recentlyAddedDays = document.getElementById('recentlyAddedDays');
                    if (recentlyAddedDays && config.recentlyAddedDays !== undefined) {
                        recentlyAddedDays.value = config.recentlyAddedDays;
                    }
                    
                    var longNotWatchedMonths = document.getElementById('longNotWatchedMonths');
                    if (longNotWatchedMonths && config.longNotWatchedMonths !== undefined) {
                        longNotWatchedMonths.value = config.longNotWatchedMonths;
                    }
                    
                    var minGenreItems = document.getElementById('minGenreItems');
                    if (minGenreItems && config.minGenreItems !== undefined) {
                        minGenreItems.value = config.minGenreItems;
                    }
                    
                    var myListLimit = document.getElementById('myListLimit');
                    if (myListLimit && config.myListLimit !== undefined) {
                        myListLimit.value = config.myListLimit;
                    }
                    
                    // Row types
                    this.setCheckbox('enableMyList', config.enableMyList !== false);
                    this.setCheckbox('enableRecentlyAdded', config.enableRecentlyAdded !== false);
                    this.setCheckbox('enableRandomPicks', config.enableRandomPicks !== false);
                    this.setCheckbox('enableLongNotWatched', config.enableLongNotWatched === true);
                    
                    // Advanced options
                    this.setCheckbox('randomRowOrder', config.randomRowOrder === true);
                    this.setCheckbox('lazyLoadRows', config.lazyLoadRows !== false);
                    this.setCheckbox('replaceHeartWithPlus', config.replaceHeartWithPlus !== false);
                    
                    // Genres
                    if (config.enabledGenres && Array.isArray(config.enabledGenres)) {
                        var genreCheckboxes = document.querySelectorAll('input[name="enabledGenres"]');
                        genreCheckboxes.forEach(function(checkbox) {
                            checkbox.checked = config.enabledGenres.indexOf(checkbox.value) !== -1;
                        });
                    }
                },

                setCheckbox: function(id, checked) {
                    var element = document.getElementById(id);
                    if (element) {
                        element.checked = checked;
                    }
                },

                saveConfig: function() {
                    var self = this;
                    var config = {
                        maxRows: parseInt(document.getElementById('maxRows').value) || 8,
                        maxItemsPerRow: parseInt(document.getElementById('maxItemsPerRow').value) || 25,
                        minItemsPerRow: parseInt(document.getElementById('minItemsPerRow').value) || 10,
                        recentlyAddedDays: parseInt(document.getElementById('recentlyAddedDays').value) || 30,
                        longNotWatchedMonths: parseInt(document.getElementById('longNotWatchedMonths').value) || 6,
                        minGenreItems: parseInt(document.getElementById('minGenreItems').value) || 5,
                        myListLimit: parseInt(document.getElementById('myListLimit').value) || 50,
                        enableMyList: document.getElementById('enableMyList').checked,
                        enableRecentlyAdded: document.getElementById('enableRecentlyAdded').checked,
                        enableRandomPicks: document.getElementById('enableRandomPicks').checked,
                        enableLongNotWatched: document.getElementById('enableLongNotWatched').checked,
                        randomRowOrder: document.getElementById('randomRowOrder').checked,
                        lazyLoadRows: document.getElementById('lazyLoadRows').checked,
                        replaceHeartWithPlus: document.getElementById('replaceHeartWithPlus').checked,
                        enabledGenres: [],
                        blacklistedGenres: this.currentConfig.blacklistedGenres || [],
                        genreDisplayNames: this.currentConfig.genreDisplayNames || {
                            "Action": "Adrenalinkick",
                            "Comedy": "Zum Lachen",
                            "Drama": "Gefühlvoll",
                            "Horror": "Gruselig", 
                            "Romance": "Romantisch",
                            "Thriller": "Spannend",
                            "Sci-Fi": "Science Fiction",
                            "Fantasy": "Fantasie",
                            "Crime": "Krimi",
                            "Documentary": "Dokumentation",
                            "Adventure": "Abenteuer",
                            "Animation": "Animation",
                            "Biography": "Biografie",
                            "Family": "Familie",
                            "History": "Geschichte",
                            "Music": "Musik",
                            "Mystery": "Mystery",
                            "Sport": "Sport",
                            "War": "Krieg",
                            "Western": "Western"
                        },
                        myListCount: this.currentConfig.myListCount || 20,
                        recentlyAddedCount: this.currentConfig.recentlyAddedCount || 20,
                        randomPicksCount: this.currentConfig.randomPicksCount || 20
                    };

                    // Collect enabled genres
                    var genreCheckboxes = document.querySelectorAll('input[name="enabledGenres"]:checked');
                    genreCheckboxes.forEach(function(checkbox) {
                        config.enabledGenres.push(checkbox.value);
                    });

                    self.showStatus('Saving...', 'info');

                    ApiClient.ajax({
                        type: 'POST',
                        url: ApiClient.getUrl('NetflixRows/Config'),
                        data: JSON.stringify(config),
                        contentType: 'application/json'
                    }).then(function() {
                        self.currentConfig = config;
                        self.showStatus('Configuration saved successfully!', 'success');
                    }).catch(function(error) {
                        console.error('Error saving configuration:', error);
                        self.showStatus('Error saving configuration', 'error');
                    });
                },

                showStatus: function(message, type) {
                    var statusDiv = document.getElementById('status');
                    if (statusDiv) {
                        statusDiv.textContent = message;
                        statusDiv.style.display = 'block';
                        statusDiv.className = 'fieldDescription status-' + type;
                        
                        if (type === 'success') {
                            setTimeout(function() {
                                statusDiv.style.display = 'none';
                            }, 3000);
                        }
                    }
                },

                init: function() {
                    var self = this;
                    var saveBtn = document.getElementById('saveBtn');
                    if (saveBtn) {
                        saveBtn.addEventListener('click', function() {
                            self.saveConfig();
                        });
                    }
                    
                    // Initialize collapsible sections
                    this.initCollapsibleSections();
                    
                    // Load configuration on page load
                    this.loadConfig();
                },
                
                initCollapsibleSections: function() {
                    var toggleButtons = document.querySelectorAll('.collapsible-toggle');
                    toggleButtons.forEach(function(button) {
                        button.addEventListener('click', function() {
                            var targetId = this.getAttribute('data-target');
                            var targetElement = document.getElementById(targetId);
                            var icon = this.querySelector('.md-icon');
                            
                            if (targetElement) {
                                var isVisible = targetElement.style.display !== 'none';
                                
                                if (isVisible) {
                                    targetElement.style.display = 'none';
                                    icon.textContent = 'keyboard_arrow_down';
                                } else {
                                    targetElement.style.display = 'block';
                                    icon.textContent = 'keyboard_arrow_up';
                                }
                            }
                        });
                    });
                }
            };

            // Initialize when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    NetflixRowsConfigPage.init();
                });
            } else {
                NetflixRowsConfigPage.init();
            }
        })();
    </script>
    
    <style>
        .status-success {
            color: #00a652;
        }
        
        .status-error {
            color: #cc3333;
        }
        
        .status-info {
            color: #00a4dc;
        }
        
        .description {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 2em;
        }
        
        .verticalSection {
            margin-bottom: 2em;
        }
        
        .sectionTitle {
            color: #00a4dc;
        }
        
        .checkboxContainer-withDescription {
            margin-bottom: 1.5em;
        }
        
        .checkboxFieldDescription {
            margin-left: 1.8em;
            margin-top: 0.3em;
        }
        
        /* Collapsible sections */
        .collapsible-toggle {
            background: none;
            border: none;
            color: #00a4dc;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .collapsible-toggle:hover {
            background-color: rgba(0, 164, 220, 0.1);
        }
        
        .collapsible-toggle .md-icon {
            font-size: 20px;
            transition: transform 0.2s;
        }
        
        .collapsible-content {
            padding-top: 1em;
            transition: all 0.3s ease;
        }
        
        .sectionTitleContainer {
            cursor: pointer;
            padding: 0.5em 0;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .sectionTitleContainer:hover {
            background-color: rgba(255, 255, 255, 0.02);
        }
    </style>
</body>
</html>