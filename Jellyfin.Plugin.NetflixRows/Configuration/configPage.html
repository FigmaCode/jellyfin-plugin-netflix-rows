<!DOCTYPE html>
<html>
<head>
    <title>Netflix Rows Configuration</title>
</head>
<body>
    <div data-role="page" class="page" id="netflixRowsConfigPage">
        <div data-role="content">
            <div class="content-primary">
                <h1>Netflix Rows Configuration</h1>
                
                <form id="netflixRowsConfigForm">
                    <h2>General Settings</h2>
                    
                    <div class="fieldContainer">
                        <label for="maxRows">Maximum Rows:</label>
                        <input type="number" id="maxRows" name="maxRows" value="8" min="1" max="20" class="emby-input">
                        <div class="fieldDescription">Maximum number of rows to display on the home page.</div>
                    </div>
                    
                    <div class="fieldContainer">
                        <label for="maxItemsPerRow">Items per Row:</label>
                        <input type="number" id="maxItemsPerRow" name="maxItemsPerRow" value="25" min="5" max="50" class="emby-input">
                        <div class="fieldDescription">Number of items to show in each row.</div>
                    </div>
                    
                    <h2>Row Types</h2>
                    
                    <div class="fieldContainer">
                        <label class="emby-checkbox-label">
                            <input type="checkbox" id="enableMyList" name="enableMyList" checked class="emby-checkbox">
                            <span>Enable My List</span>
                        </label>
                        <div class="fieldDescription">Show user favorites in a dedicated row.</div>
                    </div>
                    
                    <div class="fieldContainer">
                        <label class="emby-checkbox-label">
                            <input type="checkbox" id="enableRecentlyAdded" name="enableRecentlyAdded" checked class="emby-checkbox">
                            <span>Enable Recently Added</span>
                        </label>
                        <div class="fieldDescription">Show recently added content.</div>
                    </div>
                    
                    <div class="fieldContainer">
                        <label class="emby-checkbox-label">
                            <input type="checkbox" id="enableRandomPicks" name="enableRandomPicks" checked class="emby-checkbox">
                            <span>Enable Random Picks</span>
                        </label>
                        <div class="fieldDescription">Show random content suggestions.</div>
                    </div>
                    
                    <h2>Genres</h2>
                    
                    <div class="fieldContainer">
                        <label class="emby-checkbox-label">
                            <input type="checkbox" id="genreAction" name="enabledGenres" value="Action" checked class="emby-checkbox">
                            <span>Action</span>
                        </label>
                    </div>
                    
                    <div class="fieldContainer">
                        <label class="emby-checkbox-label">
                            <input type="checkbox" id="genreComedy" name="enabledGenres" value="Comedy" checked class="emby-checkbox">
                            <span>Comedy</span>
                        </label>
                    </div>
                    
                    <div class="fieldContainer">
                        <label class="emby-checkbox-label">
                            <input type="checkbox" id="genreAnime" name="enabledGenres" value="Anime" checked class="emby-checkbox">
                            <span>Anime</span>
                        </label>
                    </div>
                    
                    <div class="fieldContainer">
                        <label class="emby-checkbox-label">
                            <input type="checkbox" id="genreDrama" name="enabledGenres" value="Drama" class="emby-checkbox">
                            <span>Drama</span>
                        </label>
                    </div>
                    
                    <br>
                    
                    <button type="button" id="saveBtn" class="raised emby-button">
                        <span>Save Configuration</span>
                    </button>
                    
                    <button type="button" id="testBtn" class="emby-button" style="margin-left: 10px;">
                        <span>Test Connection</span>
                    </button>
                </form>
                
                <div id="status" style="margin-top: 20px; padding: 10px; display: none;"></div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        (function () {
            'use strict';

            function NetflixRowsConfigPage() {
                var self = this;
                var currentConfig = {};

                self.loadConfig = function() {
                    console.log('Loading Netflix Rows configuration...');
                    
                    ApiClient.getJSON(ApiClient.getUrl('NetflixRows/Config')).then(function (config) {
                        console.log('Configuration loaded:', config);
                        currentConfig = config;
                        self.populateForm(config);
                        self.showStatus('Configuration loaded successfully', 'success');
                    }).catch(function (error) {
                        console.error('Error loading configuration:', error);
                        self.showStatus('Error loading configuration: ' + error.message, 'error');
                    });
                };

                self.populateForm = function(config) {
                    // Basic settings
                    var maxRows = document.getElementById('maxRows');
                    if (maxRows && config.maxRows !== undefined) {
                        maxRows.value = config.maxRows;
                    }
                    
                    var maxItemsPerRow = document.getElementById('maxItemsPerRow');
                    if (maxItemsPerRow && config.maxItemsPerRow !== undefined) {
                        maxItemsPerRow.value = config.maxItemsPerRow;
                    }
                    
                    // Row types
                    var enableMyList = document.getElementById('enableMyList');
                    if (enableMyList) {
                        enableMyList.checked = config.enableMyList !== false;
                    }
                    
                    var enableRecentlyAdded = document.getElementById('enableRecentlyAdded');
                    if (enableRecentlyAdded) {
                        enableRecentlyAdded.checked = config.enableRecentlyAdded !== false;
                    }
                    
                    var enableRandomPicks = document.getElementById('enableRandomPicks');
                    if (enableRandomPicks) {
                        enableRandomPicks.checked = config.enableRandomPicks !== false;
                    }
                    
                    // Genres
                    if (config.enabledGenres && Array.isArray(config.enabledGenres)) {
                        var genreCheckboxes = document.querySelectorAll('input[name="enabledGenres"]');
                        genreCheckboxes.forEach(function(checkbox) {
                            checkbox.checked = config.enabledGenres.indexOf(checkbox.value) !== -1;
                        });
                    }
                };

                self.saveConfig = function() {
                    console.log('Saving Netflix Rows configuration...');
                    
                    var config = {
                        maxRows: parseInt(document.getElementById('maxRows').value) || 8,
                        maxItemsPerRow: parseInt(document.getElementById('maxItemsPerRow').value) || 25,
                        minItemsPerRow: 10,
                        enableMyList: document.getElementById('enableMyList').checked,
                        enableRecentlyAdded: document.getElementById('enableRecentlyAdded').checked,
                        enableRandomPicks: document.getElementById('enableRandomPicks').checked,
                        enableLongNotWatched: currentConfig.enableLongNotWatched || false,
                        enabledGenres: [],
                        blacklistedGenres: currentConfig.blacklistedGenres || [],
                        recentlyAddedDays: currentConfig.recentlyAddedDays || 30,
                        longNotWatchedMonths: currentConfig.longNotWatchedMonths || 6,
                        minGenreItems: currentConfig.minGenreItems || 5,
                        myListLimit: currentConfig.myListLimit || 50,
                        randomRowOrder: currentConfig.randomRowOrder || false,
                        lazyLoadRows: currentConfig.lazyLoadRows !== false,
                        replaceHeartWithPlus: currentConfig.replaceHeartWithPlus !== false,
                        myListCount: currentConfig.myListCount || 20,
                        recentlyAddedCount: currentConfig.recentlyAddedCount || 20,
                        randomPicksCount: currentConfig.randomPicksCount || 20
                    };

                    // Collect enabled genres
                    var genreCheckboxes = document.querySelectorAll('input[name="enabledGenres"]:checked');
                    genreCheckboxes.forEach(function(checkbox) {
                        config.enabledGenres.push(checkbox.value);
                    });

                    console.log('Saving config:', config);

                    ApiClient.ajax({
                        type: 'POST',
                        url: ApiClient.getUrl('NetflixRows/Config'),
                        data: JSON.stringify(config),
                        contentType: 'application/json'
                    }).then(function () {
                        console.log('Configuration saved successfully');
                        currentConfig = config;
                        self.showStatus('Configuration saved successfully!', 'success');
                    }).catch(function (error) {
                        console.error('Error saving configuration:', error);
                        self.showStatus('Error saving configuration: ' + error.message, 'error');
                    });
                };

                self.testConnection = function() {
                    console.log('Testing Netflix Rows API connection...');
                    self.showStatus('Testing API connection...', 'info');
                    
                    ApiClient.getJSON(ApiClient.getUrl('NetflixRows/Test')).then(function (response) {
                        console.log('API test successful:', response);
                        self.showStatus('API connection test successful!', 'success');
                    }).catch(function (error) {
                        console.error('API test failed:', error);
                        self.showStatus('API test failed: ' + error.message, 'error');
                    });
                };

                self.showStatus = function(message, type) {
                    var statusDiv = document.getElementById('status');
                    if (statusDiv) {
                        statusDiv.textContent = message;
                        statusDiv.style.display = 'block';
                        statusDiv.className = 'status-' + type;
                        
                        // Auto-hide after 5 seconds for success messages
                        if (type === 'success') {
                            setTimeout(function() {
                                statusDiv.style.display = 'none';
                            }, 5000);
                        }
                    }
                    console.log('Status:', message, type);
                };

                self.init = function() {
                    console.log('Initializing Netflix Rows configuration page...');
                    
                    var saveBtn = document.getElementById('saveBtn');
                    if (saveBtn) {
                        saveBtn.addEventListener('click', self.saveConfig);
                    }
                    
                    var testBtn = document.getElementById('testBtn');
                    if (testBtn) {
                        testBtn.addEventListener('click', self.testConnection);
                    }
                    
                    // Load configuration on page load
                    self.loadConfig();
                };

                return self;
            }

            // Initialize when page loads
            if (typeof define === 'function' && define.amd) {
                define([], function() {
                    return NetflixRowsConfigPage;
                });
            } else {
                window.NetflixRowsConfigPage = NetflixRowsConfigPage;
                
                // Auto-initialize if DOM is ready
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', function() {
                        var page = new NetflixRowsConfigPage();
                        page.init();
                    });
                } else {
                    var page = new NetflixRowsConfigPage();
                    page.init();
                }
            }
        })();
    </script>
    
    <style>
        .fieldContainer {
            margin-bottom: 1.5em;
        }
        
        .fieldDescription {
            color: #999;
            font-size: 0.9em;
            margin-top: 0.25em;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            border-radius: 4px;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
        }
        
        .status-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            border-radius: 4px;
        }
        
        h1 {
            color: #e50914;
            margin-bottom: 2rem;
        }
        
        h2 {
            margin-top: 2rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #e50914;
            padding-bottom: 0.5rem;
        }
    </style>
</body>
</html>